name: 半小时自动更新订阅

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch: 

jobs:
  update_link:
    runs-on: ubuntu-latest
    steps:
      - name: 检出仓库
        uses: actions/checkout@v3

      - name: 强制下载指定订阅链接
        run: |
          # 使用你提供的最新 API 链接进行下载
          # 添加 -L 是为了处理可能的重定向，-H 模拟用户代理防止被屏蔽
          curl -L "https://TYH6nu.mcsslk.xyz/75beaaac43ce1d1e9ac811f854411a0b" \
          -H "User-Agent: Clash" \
          -o config.yaml
          
          # 检查文件是否下载成功
          if [ ! -s config.yaml ]; then
            echo "错误：下载内容为空，请检查原始链接是否失效"
            exit 1
          fi

      - name: 推送更新到仓库
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Action"
          git add config.yaml
          git commit -m "自动同步最新 API 节点: $(date)" || echo "内容无变化"
          git push
