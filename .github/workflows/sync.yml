name: 1åŠå°æ—¶ç²¾å‡†æŠ“å–æœ€æ–°è®¢é˜…

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch: 

jobs:
  update_link:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v3

      - name: æŠ“å–å¹¶è½¬æ¢é…ç½®
        run: |
          # 1. è·å–åŸä½œè€… README åŸå§‹æ–‡æœ¬
          RAW_README=$(curl -s https://raw.githubusercontent.com/mksshare/mksshare.github.io/main/README.md)
          
          # 2. ç²¾å‡†å®šä½â€œğŸš€å…è´¹Clashè®¢é˜…é“¾æ¥â€æ–‡å­—åçš„ https é“¾æ¥
          # æ— è®ºåŸŸåæ€ä¹ˆå˜ï¼Œåªè¦åœ¨è¿™ä¸€è¡Œä¸‹é¢å°±èƒ½æŠ“åˆ°
          DYNAMIC_URL=$(echo "$RAW_README" | grep -A 2 "ğŸš€å…è´¹Clashè®¢é˜…é“¾æ¥" | grep -oE "https://[a-zA-Z0-9./_-]+")
          
          echo "æ£€æµ‹åˆ°å½“å‰æœ€æ–°é“¾æ¥: $DYNAMIC_URL"
          
          if [ -z "$DYNAMIC_URL" ]; then
            echo "é”™è¯¯ï¼šæœªèƒ½åœ¨é¡µé¢æ‰¾åˆ°é“¾æ¥"
            exit 1
          fi

          # 3. ä½¿ç”¨è½¬æ¢å‚æ•°ç¡®ä¿è·å–çš„æ˜¯çœŸå®çš„ Clash YAML èŠ‚ç‚¹ï¼Œè€Œéå…¬å‘Šä¿¡æ¯
          # è¿™æ ·å¯ä»¥å¼ºåˆ¶ API è¿”å›å¯ç”¨çš„èŠ‚ç‚¹åˆ—è¡¨
          curl -L "${DYNAMIC_URL}?flag=clash" -H "User-Agent: Clash" -o config.yaml

      - name: æ¨é€æ›´æ–°
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Action"
          git add config.yaml
          git commit -m "è‡ªåŠ¨åŒæ­¥æœ€æ–°èŠ‚ç‚¹: $(date)" || echo "å†…å®¹æ— å˜åŒ–"
          git push
