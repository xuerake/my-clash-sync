name: 半小时自动更新订阅

on:
  schedule:
    # 每 30 分钟运行一次
    - cron: '*/30 * * * *'
  workflow_dispatch: 

jobs:
  update_link:
    runs-on: ubuntu-latest
    steps:
      - name: 检出仓库
        uses: actions/checkout@v3

      - name: 直接下载目标文件
        run: |
          # 直接下载原作者仓库里的 clash.yaml
          curl -L "https://raw.githubusercontent.com/mksshare/mksshare.github.io/main/clash.yaml" -o config.yaml
          
          # 检查文件是否下载成功（大小是否大于1KB）
          if [ ! -s config.yaml ]; then
            echo "错误：下载的文件为空"
            exit 1
          fi

      - name: 推送到我的仓库
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Action"
          git add config.yaml
          # 只有在内容有变动时才提交，避免报错
          git diff --quiet && git diff --staged --quiet || (git commit -m "自动同步: $(date)" && git push)
